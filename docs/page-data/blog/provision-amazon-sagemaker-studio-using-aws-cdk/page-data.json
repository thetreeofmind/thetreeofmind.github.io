{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/blog/provision-amazon-sagemaker-studio-using-aws-cdk",
    "result": {"data":{"butterPost":{"title":"Provision Amazon SageMaker Studio using AWS CDK","seo_title":"Provision Amazon SageMaker Studio using AWS CDK","published":"2023-02-02T23:36:00Z","featured_image":"https://cdn.buttercms.com/N67uQykRxS3PMfAHjwgy","body":"<p><a href=\"https://aws.amazon.com/sagemaker/studio/\">Amazon SageMaker studio</a> is a web-based interface built for machine learning (ML) related tasks, including preparing and processing raw data, training ML models, tuning hyper parameters, and deploying models as service endpoints. It's a one stop shop for data scientists to quickly prototype and experiment with ML data and algorithms, and actually deploy verified models to production.</p>\r\n<p>While AWS management console currently offers a convenient way to manually create your SageMaker Studio and related resources, the manual effort and complexity can quickly add up when you have a large team of data scientists working in the same AWS account and having to spinning up their own SageMaker Studio environments. In this post, we will look at how to automate this process and provision Amazon SageMaker Studio resources using AWS Cloud Development Kit (AWS CDK).&nbsp;</p>\r\n<p></p>\r\n<h2>SageMaker studio components</h2>\r\n<p>Before we dive into the CDK code to provision SageMaker Studio, it's important to understand the components of SageMaker studio, which will help us understand what CDK constructs we need to create a SageMaker studio. Below is a diagram of main components of AWS SageMaker studio.</p>\r\n<p><img src=\"https://cdn.buttercms.com/CsWR2oq7QtGx6RvkBh2I\" alt=\"undefined\" style=\"display: block; margin-left: auto; margin-right: auto;\"></p>\r\n<p style=\"text-align: center;\">Components of AWS SageMaker studio</p>\r\n<p>As you can see from the diagram, SageMaker studio consists of SageMaker domain, SageMaker user, and SageMaker app. There can be multiple domains under the SageMaker studio, and multiple users under a SageMaker domain, and multiple apps under a SageMaker user.</p>\r\n<p></p>\r\n<h2>Prerequisite</h2>\r\n<p>Before we start, let's make sure you have the proper tools and environment set up, which means you have:</p>\r\n<ul>\r\n<li>NodeJS installed\r\n<ol>\r\n<li>run <code>brew install node</code> to install node if you use macos, or follow <a href=\"https://nodejs.dev/en/learn/how-to-install-nodejs/\">instructions here</a> to install node if you use other OS platforms.</li>\r\n<li>run <code>node -v</code> and <code>npm -v</code> to verify that you have node installed.</li>\r\n</ol>\r\n</li>\r\n<li>AWS CDK command line installed\r\n<ol>\r\n<li>run <code>npm install -g cdk</code> to install&nbsp;</li>\r\n<li>run <code>cdk --version</code> to verify</li>\r\n</ol>\r\n</li>\r\n<li>An AWS profile in your terminal that has permission to create SageMaker Studio resources</li>\r\n</ul>\r\n<p></p>\r\n<h2>Step 1 - Clone the demo code Github repo</h2>\r\n<p>Next, let's clone the demo code repo from Github. In your terminal, run</p>\r\n<pre>git clone -b sagemaker-studio https://github.com/StephenWeiXu/sagemaker-demos.git<br>cd sagemaker-demos</pre>\r\n<p>This demo repo is a classic AWS CDK JavaScript package. There are several main files in this repo:</p>\r\n<ul>\r\n<li><code>bin/sagemaker-demos.js</code> - the entry point file where the main cdk app and stacks are defined</li>\r\n<li><code>lib/sagemaker-studio-stack.js</code> - the SageMaker Studio stack file that defines Studio domain, Studio user profile, and Studio user app</li>\r\n</ul>\r\n<p>Taking a deeper look at the main CDK code in <code>lib/sagemaker-studio-stack.js</code>, you can see that we first need to define a IAM role to be used by SageMaker domain and SageMaker user to manage permission.</p>\r\n<pre>&nbsp; &nbsp; let sagemakerExecutionRole = new Role(this, 'SageMakerExecutionRole', {<br>&nbsp; &nbsp; &nbsp; assumedBy: new ServicePrincipal('sagemaker.amazonaws.com'),<br>&nbsp; &nbsp; &nbsp; roleName: `SageMakerExecutionRole-${identifier}-${region}`,<br>&nbsp; &nbsp; });</pre>\r\n<p>Then we define a new SageMaker domain under the default VPC (you can choose to define a custom VPC for better isolation and network management), using the <code>CfnDomain</code> construct. The new SageMaker domain uses IAM as auth mode and the IAM role we defined early.&nbsp;</p>\r\n<pre>&nbsp; &nbsp; const sagemakerDomain = new CfnDomain(this, `SagemakerDomain-${identifier}`, {<br>&nbsp; &nbsp; &nbsp; authMode: 'IAM',<br>&nbsp; &nbsp; &nbsp; defaultUserSettings: userSettings,<br>&nbsp; &nbsp; &nbsp; domainName: `sagemaker-domain-${identifier}`,<br>&nbsp; &nbsp; &nbsp; subnetIds: vpcSubnets.subnetIds,<br>&nbsp; &nbsp; &nbsp; vpcId: defaultVpc.vpcId,<br>&nbsp; &nbsp; });</pre>\r\n<p>Then we define a new user profile under the SageMaker domain, using the <code>CfnUserProfile</code> construct.</p>\r\n<pre>&nbsp; &nbsp; const profile = {'team': 'data-science-team', 'name': 'johndoe'}<br>&nbsp; &nbsp; const userProfile = new CfnUserProfile(this, `Team-${profile.team}-User-${profile.name}`, {<br>&nbsp; &nbsp; &nbsp; domainId: sagemakerDomain.attrDomainId,<br>&nbsp; &nbsp; &nbsp; userProfileName: `User-${profile.name}`,<br>&nbsp; &nbsp; &nbsp; userSettings: userSettings,<br>&nbsp; &nbsp; });</pre>\r\n<p>Then we define a default app under the SageMaker user, using the CfnApp construct. The app is associated with the particular SageMaker user.</p>\r\n<pre>&nbsp; &nbsp; const defaultApp = new CfnApp(this, `User-${profile.name}-App-default`, {<br>&nbsp; &nbsp; &nbsp; appName: 'default',<br>&nbsp; &nbsp; &nbsp; appType: 'JupyterServer',<br>&nbsp; &nbsp; &nbsp; domainId: sagemakerDomain.attrDomainId,<br>&nbsp; &nbsp; &nbsp; userProfileName: userProfile.userProfileName<br>  &nbsp; });</pre>\r\n<p></p>\r\n<h2>Step 2 - Deploy your SageMaker Studio stack</h2>\r\n<p>Now that we have the complete code that defines a SageMaker Studio stack, let's run the CDK command line to deploy the CDK stack to your AWS account.</p>\r\n<p>To deploy your AWS CDK stack, run the following commands inside the repo in your terminal:</p>\r\n<pre>// Make sure your terminal is already authenticated with AWS credentials for your desired AWS account<br><br>cdk synth<br>cdk bootstrap<br>cdk deploy</pre>\r\n<p>Wait for the command to finish and your stack should be deployed to your desired AWS account.</p>\r\n<p></p>\r\n<h2>Step 3 - Review your SageMaker Studio stack</h2>\r\n<p>Let's take a look at the SageMaker Studio stack provisioned by our CDK deployment.&nbsp;</p>\r\n<p>Open <code>Cloud Formation</code> in the AWS management console, you will see the following SageMaker Studio stack and resources created.</p>\r\n<p><img src=\"https://cdn.buttercms.com/eSSunvxQm6DPDc1B4ICh\" alt=\"undefined\" width=\"800\" style=\"display: block; margin-left: auto; margin-right: auto;\"></p>\r\n<p>As provisioned by the CDK code, Cloud Formation created the following resources for the stack:</p>\r\n<ul>\r\n<li>A SageMakerExecutionRole IAM role to control what SageMaker domain user can access</li>\r\n<li>A SageMaker domain</li>\r\n<li>A SageMaker domain user</li>\r\n<li>A default SageMaker app under the SageMaker domain user</li>\r\n</ul>\r\n<p>Open <code>AWS SageMaker console</code>, you will then see the actual SageMaker domain called <code>sagemaker-domain-example</code> created.</p>\r\n<p><img src=\"https://cdn.buttercms.com/SOazj3YR2e78NX11RsPC\" alt=\"sagemaker-studio-domain.webp\" width=\"1000\" style=\"display: block; margin-left: auto; margin-right: auto;\"></p>\r\n<p></p>\r\n<p>Click into the domain, and you will see a domain user called <code>user-johndoe</code> is created under the SageMaker domain.</p>\r\n<p><img src=\"https://cdn.buttercms.com/pHquZTqVRu2Hmntgw6zs\" alt=\"undefined\" width=\"1000\" style=\"display: block; margin-left: auto; margin-right: auto;\"></p>\r\n<p>Click into the user, and you will see an app called <code>default</code> is created under the SageMaker domain user as well.&nbsp;</p>\r\n<p><img src=\"https://cdn.buttercms.com/88x6Vug6SGCxaUpXGQYQ\" alt=\"undefined\" width=\"1000\" style=\"display: block; margin-left: auto; margin-right: auto;\"></p>\r\n<p></p>\r\n<p>From the default app, you can launch the actual Studio interface. This will open up a <code>Jupiter Server interface</code> and present the actual SageMaker Studio workspace, where you can create Jupiter notebooks, run experiments, and access other features like SageMaker projects, SageMaker pipelines, and SageMaker endpoints etc.</p>\r\n<p><img src=\"https://cdn.buttercms.com/Ylq3SmWiTsi5bGXdn5zE\" alt=\"undefined\" width=\"1000\" style=\"display: block; margin-left: auto; margin-right: auto;\"></p>\r\n<p></p>\r\n<h2>Final Words</h2>\r\n<p>Automating the creation of SageMaker studio with AWS CDK comes in handy when you have a large team of data scientists creating their own SageMaker domains and workspaces. Using AWS CDK makes this process repeatable, secure, and more scalable. Give the CDK code a try and customize it to your own needs. Next, we will look at how to use AWS CDK to provision another important AWS SageMaker feature - SageMaker Project.</p>\r\n<p></p>","date":"2/3/2023","meta_description":"In this post, we will look at how to automate this process and provision Amazon SageMaker Studio resources using AWS Cloud Development Kit.","tags":[{"name":"AWS SageMaker"},{"name":"SageMaker Studio"},{"name":"SageMaker domain"},{"name":"AWS CDK"},{"name":"Cloud Development Toolkit"}]}},"pageContext":{"slug":"provision-amazon-sagemaker-studio-using-aws-cdk"}},
    "staticQueryHashes": []}